window.onload=function(){"use strict";var e=document.createElement("div");e.id="npw-map-wrapper";var t=document.createElement("div");t.id="npw-map-sidebar";var n=document.createElement("div");n.id="npw-map-sidebar-header";var a=document.createElement("div");a.id="npw-map-logo";var i=document.createElement("div");i.id="npw-map-back";var d=document.createElement("input");d.id="npw-map-sidebar-search",d.setAttribute("type","text"),d.setAttribute("placeholder","Введіть номер відділення"),n.appendChild(a),n.appendChild(i),n.appendChild(d);var o=document.createElement("div");o.id="npw-map-state-list";var s=document.createElement("select");s.id="npw-cities",s.setAttribute("name","npw-cities"),s.setAttribute("onchange","NPWidgetMap.onCityChange(this.value)");var l=document.createElement("ul");l.id="npw-map-sidebar-ul",o.appendChild(s),o.appendChild(l);var r=document.createElement("div");r.id="npw-map-state-details",t.appendChild(n),t.appendChild(o),t.appendChild(r);var p=document.createElement("div");p.id="npw-map";var c=document.createElement("div");c.id="npw-map-close-button",e.appendChild(t),e.appendChild(p),e.appendChild(c),document.body.appendChild(e)}();var NPWidgetMap=function(){"use strict";function e(e,t,n,a,i){var d=new XMLHttpRequest;d.open(e,t,a),d.setRequestHeader("Content-Type","application/json"),d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);return i(e)}},d.send(n)}function t(){m.classList.contains("npw-display-block")?m.classList.remove("npw-display-block"):m.classList.add("npw-display-block"),g.classList.contains("npw-map-open-button-opened")?g.classList.remove("npw-map-open-button-opened"):g.classList.add("npw-map-open-button-opened");var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,t=document.body.clientWidth||window.innerWidth;m.style.top=e+15+"px",m.style.left=(t-m.offsetWidth)/2+"px"}function n(e,t){var n;n="loc"in e.target.attributes?e.target.attributes.loc.value.replace("(","").replace(")","").split(","):e.target.parentNode.getAttribute("loc").replace("(","").replace(")","").split(",");var i={lat:1*n[0],lng:1*n[1]};if(c.setCenter(new google.maps.LatLng(i)),t){var d=0;d="data-idx"in e.target.attributes?e.target.attributes["data-idx"].value:e.target.parentNode.getAttribute("data-idx"),a("stateDetails",d),A[d].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){A[d].setAnimation(null)},2120)}}function a(e,t){var n="";switch(e){case"stateDetails":f.style.display="none",y.style.display="block",b.style.display="none",w.style.display="block",n=encodeURI("https://novaposhta.ua/ru/office/view/id/"+A[t].number+"/city/"+A[t].name),y.innerHTML="<div class='npw-details-title'>Відділення №"+A[t].number+"</div><div>Адреса: "+A[t].vicinity+"</div><div>Телефон: "+A[t].phone+"</div><div>Тип: "+A[t].type+"</div><div>Обмеження ваги: "+A[t].maxWeight+"</div><div><a href="+n+" target='_blank'>Більше інформації на сайті</a></div>";break;case"stateList":f.style.display="block",y.style.display="none",b.style.display="block",w.style.display="none",y.innerHTML=""}}function i(e){new google.maps.Marker({map:c,position:e})}function d(t){e("POST","https://api.novaposhta.ua/v2.0/json/",JSON.stringify({modelName:"Address",calledMethod:"getCities",methodProperties:{MarketplacePartnerToken:"005056887b8d-856b-11e6-9121-25f3f736"}}),!0,function(e){for(var n=e.data,a=0;a<n.length;a++){var i=document.createElement("option");i.setAttribute("value",n[a].Description),i.appendChild(document.createTextNode(n[a].Description)),h.appendChild(i)}h.value=t||k.name})}function o(e){document.getElementById("npw-map-sidebar-search").value="";for(var t=0;t<A.length;t++)A[t].setMap(null);A.length=0,r(e,!0,!0),a("stateList")}function s(e){for(var t=e.toLowerCase(),n=v.children,a=0;a<n.length;a++)n[a].innerHTML.toLowerCase().indexOf(t)>-1||""==t?n[a].style.display="block":n[a].style.display="none"}function l(){function e(e){function t(){var e=JSON.parse(this.responseText),t=e.results;if(0===t.length)u=k.name,d(u,!0);else for(var n=0;n<t.length;n++)if(t[n].types.indexOf("locality")!==-1){u=t[n].address_components[0].long_name,d(u);break}r(u)}c.setCenter(new google.maps.LatLng(e.coords.latitude,e.coords.longitude)),i({lat:e.coords.latitude,lng:e.coords.longitude});var n=new XMLHttpRequest;n.addEventListener("load",t),n.open("GET","https://maps.googleapis.com/maps/api/geocode/json?latlng="+e.coords.latitude+","+e.coords.longitude+"&language=uk&result_type=locality&key=AIzaSyAPhm7Q29X5ldwjLtA7IMYHU_0xATiWK3A"),n.send()}E=!0,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e(t)},function(t){e(k)}):e(k),c=new google.maps.Map(document.getElementById("npw-map"),{center:new google.maps.LatLng(k.lat,k.lng),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0})}function r(t,i,d){e("POST","https://api.novaposhta.ua/v2.0/json/",JSON.stringify({modelName:"AddressGeneral",calledMethod:"getWarehouses",methodProperties:{MarketplacePartnerToken:"005056887b8d-856b-11e6-9121-25f3f736",CityName:t}}),!0,function(e){var t=e.data;for(0===t.length&&(u=k.name,r(k.name),M=!0);v.firstChild;)v.removeChild(v.firstChild);for(var o=[],s=0;s<t.length;s++){var l=new google.maps.Marker({position:new google.maps.LatLng(t[s].Latitude,t[s].Longitude),map:c,name:t[s].CityDescription,vicinity:t[s].Description,number:t[s].Number,phone:t[s].Phone,type:p(t[s].TypeOfWarehouse),maxWeight:t[s].TotalMaxWeightAllowed,icon:"https://apimgmtstorelinmtekiynqw.blob.core.windows.net/content/MediaLibrary/Widget/img/np-marker.png",index:s});A.push(l),google.maps.event.addListener(l,"click",function(){a("stateDetails",this.index)}),o=t[s].Description.split(":"),o.length<2&&(o[1]=o[0]);var m=document.createElement("li");m.addEventListener("click",function(e){NPWidgetMap.setMapCenter(e,!0)}),m.setAttribute("loc","("+t[s].Latitude+","+t[s].Longitude+")"),m.setAttribute("data-idx",s),m.innerHTML="<div class='npw-list-city'>"+t[s].CityDescription+"</div><div class='npw-list-warehouse' >"+o[0]+"</div><div class='npw-list-address'>"+o[1]+"</div>",v.appendChild(m)}(M&&t.length>0||i===!0)&&(T={target:{attributes:{loc:{value:"("+t[0].Latitude+","+t[0].Longitude+")"}}}},n(T),d||(h.value=k.name))})}function p(e){switch(e){case"6f8c7162-4b72-4b0a-88e5-906948c6a92f":return"Міні-відділення";case"841339c7-591a-42e2-8233-7a0a00f0ed6f":return"Поштове відділення";case"95dc212d-479c-4ffb-a8ab-8c1b9073d0bc":return"Поштомат приват банку";case"9a68df70-0267-42a8-bb5c-37f427e36ee4":return"Вантажне відділення";case"cab18137-df1b-472d-8737-22dd1d18b51d":return"Поштомат InPost";case"f9316480-5f2d-425d-bc2c-ac7cd29decf0":return"Поштомат";default:return""}}var c,u,m=document.getElementById("npw-map-wrapper"),g=document.getElementById("npw-map-open-button"),v=document.getElementById("npw-map-sidebar-ul"),h=document.getElementById("npw-cities"),f=document.getElementById("npw-map-state-list"),y=document.getElementById("npw-map-state-details"),b=document.getElementById("npw-map-logo"),w=document.getElementById("npw-map-back"),L=document.getElementById("npw-map-sidebar-search"),C=document.getElementById("npw-map-close-button"),E=!1,k={lat:50.4501,lng:30.5234,coords:{latitude:50.4501,longitude:30.5234},name:"Київ"},M=!1,A=[],T={};return g.addEventListener("click",function(){t(),E||l()},!1),w.addEventListener("click",function(){a("stateList")}),L.addEventListener("input",function(e){s(e.target.value)}),C.addEventListener("click",function(){t()}),{setMapCenter:n,onCityChange:o,state:a}}();